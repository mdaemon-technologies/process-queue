!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).ProcessQueue=n()}(this,(function(){"use strict";"function"==typeof SuppressedError&&SuppressedError;var e=function(e,n){void 0===e&&(e=!1),void 0===n&&(n=1e3);var t=this;this._emplace=e,this._maxSize=n,this._queue=[],this._inProcess=new Map,this.isProcessing=function(e){return!!t._inProcess.get(e)},this.queueItem=function(e){if(!("string"==typeof(n=e.id)&&n.length>0||"number"==typeof n))throw new Error("Invalid queue item: must have an id property");var n;if(t._queue.length>=t._maxSize)throw new Error("Queue size limit reached");if(t.isProcessing(e.id))return!1;var i=t._queue.findIndex((function(n){return n.id===e.id}));return t._emplace?i>=0?(t._queue.splice(i,1,e),!0):(t._queue.push(e),!0):(i>=0&&t._queue.splice(i,1),t._queue.unshift(e),!0)},this.getNextItem=function(){var e=t._queue.shift();return e?(t._inProcess.set(e.id,e),e):null},this.getQueue=function(e){return void 0===e&&(e=!1),e?t.processBatch(t._queue.length):function(e,n,t){if(t||2===arguments.length)for(var i,u=0,r=n.length;u<r;u++)!i&&u in n||(i||(i=Array.prototype.slice.call(n,0,u)),i[u]=n[u]);return e.concat(i||Array.prototype.slice.call(n))}([],t._queue,!0)},this.processBatch=function(e){var n=t._queue.splice(0,e);return n.forEach((function(e){return t._inProcess.set(e.id,e)})),n},this.removeFromQueue=function(e){var n=t._queue.findIndex((function(n){return n.id===e}));return-1!==n&&(t._queue.splice(n,1),!0)},this.doneProcessing=function(e){void 0===e?t._inProcess.clear():t._inProcess.delete(e)},this.length=function(e,n){return t._queue.length?void 0!==e&&t._queue.length&&void 0!==t._queue[0][e]&&void 0!==n?t._queue.filter((function(t){return t[e]===n})).length:t._queue.length:0},this.clear=function(){t._queue.splice(0,t._queue.length),t._inProcess.clear()},this.isEmpty=function(){return 0===t._queue.length},this.busy=function(){return t._inProcess.size>0},this.processSize=function(){return t._inProcess.size}};return e}));
