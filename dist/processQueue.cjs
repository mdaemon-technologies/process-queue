"use strict";"function"==typeof SuppressedError&&SuppressedError;var e=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=1e3);var u=this;this._emplace=e,this._maxSize=t,this._queue=[],this._inProcess=new Map,this.isProcessing=function(e){return!!u._inProcess.get(e)},this.queueItem=function(e){if(!("string"==typeof(t=e.id)&&t.length>0||"number"==typeof t))throw new Error("Invalid queue item: must have an id property");var t;if(u._queue.length>=u._maxSize)throw new Error("Queue size limit reached");if(u.isProcessing(e.id))return!1;var i=u._queue.findIndex((function(t){return t.id===e.id}));return u._emplace?i>=0?(u._queue.splice(i,1,e),!0):(u._queue.push(e),!0):(i>=0&&u._queue.splice(i,1),u._queue.unshift(e),!0)},this.getNextItem=function(){var e=u._queue.shift();return e?(u._inProcess.set(e.id,e),e):null},this.getQueue=function(e){return void 0===e&&(e=!1),e?u.processBatch(u._queue.length):function(e,t,u){if(u||2===arguments.length)for(var i,n=0,r=t.length;n<r;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}([],u._queue,!0)},this.processBatch=function(e){var t=u._queue.splice(0,e);return t.forEach((function(e){return u._inProcess.set(e.id,e)})),t},this.removeFromQueue=function(e){var t=u._queue.findIndex((function(t){return t.id===e}));return-1!==t&&(u._queue.splice(t,1),!0)},this.doneProcessing=function(e){void 0===e?u._inProcess.clear():u._inProcess.delete(e)},this.length=function(e,t){return u._queue.length?void 0!==e&&u._queue.length&&void 0!==u._queue[0][e]&&void 0!==t?u._queue.filter((function(u){return u[e]===t})).length:u._queue.length:0},this.clear=function(){u._queue.splice(0,u._queue.length),u._inProcess.clear()},this.isEmpty=function(){return 0===u._queue.length},this.busy=function(){return u._inProcess.size>0},this.processSize=function(){return u._inProcess.size}};module.exports=e;
